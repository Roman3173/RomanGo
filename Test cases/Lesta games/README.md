
Всего есть 3 блока:
1. [На знание математики (теорвер, матстат)](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/README.md#%D0%B1%D0%BB%D0%BE%D0%BA-%D0%BD%D0%B0-%D0%B7%D0%BD%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BC%D0%B0%D1%82%D0%B5%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B8)
2. [На знание SQL](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/README.md#sql-%D0%B1%D0%BB%D0%BE%D0%BA)
3. [На знание метрик](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/README.md#%D0%B1%D0%BB%D0%BE%D0%BA-%D1%81-%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D0%BA%D0%B0%D0%BC%D0%B8)

*(в строке выше документа, начинающейся с кнопки "Preview" самый правый символ вызывает оглавление)

# Блок на знание математики
## 1 вопрос

На стажировку по аналитике записалось 2 563 человека. Стажировка делится на три модуля. Их можно пройти в любом порядке, например, пропустить первые два и изучить только третий. Первый модуль прошли 1 823 студентов, второй — 2 127, а третий — 1 944.

Каково минимальное количество стажёров, прошедших все три модуля?

**Ответ: 768**

**Решение:**
``` python []
studnets = 2563
x = studnets
y = [1823, 1944, 2127]
res = 0
for i in range(len(y)):
    delta = x - y.pop()
    y = [yy - delta for yy in y]
    x -= delta
    res += delta
print(studnets - res)
```
## 2 вопрос

Радовид V Свирепый поймал на воровстве Сигизмунда Дийкстру и приказал вернуть в казну 111 133 кроны. На следующий день Дийкстра привёз сундук с 40 000 монет разного достоинства: один, три и пять крон. «Сколько и требовалось!» — воскликнул Дийкстра.

Обманул Дийкстра короля Редании или нет?

**Ответ: Обманул.**

**Решение:**

Построим систему уравнений:

x + 3y + 5z = 111 133, и

x + y + z = 40 000

В качестве промежуточного результата найдём:

y + 2z = 35 566.5, то есть либо монет с номиналом 3 кроны, либо 5 крон должно быть нечётное количество.

Значит, Дийкстра привёз либо больше, либо меньше положенного, но не ровно.

## 3 вопрос

На 3-ем этаже бизнес-центра 7 кабинетов.

Сколькими способами можно рассадить 5 сотрудников по кабинетам, при условии, что все они должны находиться в различных кабинетах?

**Ответ: 2520**

**Решение**: n! / (n - k)!  = 7! / (7 - 5)! = 2520

## 4 вопрос

Стажёр, изучающий теорию вероятностей, раздобыл отрывной календарь за 2019 год и вырвал в нём наугад одну страницу.

Найди вероятность того, что число на вырванном листке кратно 6.

**Ответ: 0.1616 или 16.16%**

**Решение:**

(30 / 6 * 12 - 1) / 365 = 0.1616, где
* 30 / 6 -- количество кратных 6 дней в месяце,
* 12 месяцев,
* минус 1 -- поправка на февраль (28 дней),
* 365 -- 2019 год был не високосным.

## 5 вопрос

Однажды пожиратели смерти поймали Гермиону и дали ей выбирать из её же зелий: зелье невидимости или напиток живой смерти. Зелье невидимости позволит Гермионе сбежать, а напиток живой смерти вызовет вечный сон. Выбор происходит так: Гермиона сама берёт 50 зелий невидимости и 50 зелий, вызывающих вечный сон, и как угодно раскладывает их по двум одинаковым коробкам, а потом пожиратель смерти сам выбирает любую коробку и не глядя достаёт оттуда случайное зелье. Гермиона должна будет его выпить.

Как Гермионе нужно разложить все зелья по коробкам, чтобы максимально увеличить свои шансы на побег? Какова вероятность успеха?

**Ответ: Любой вариант приведёт к вероятности в 50%.**

**Решение:**

Вероятность спасения равна:

P(A) = 1/2 * (xT / 50) + 1/2 * ((50 - xT) / 50), где
* 1/2 -- это вероятность выбора одной из 2-ух коробок.
* xT -- количество зелий невидимости,
* 50 -- общее количество зелий в коробке.

P(A) = 1/100 * (xT + 50 - xT) = 50 / 100 = 0.5

## 6 вопрос

Выбери диаграмму размаха, которая соответствует распределению на гистограмме:

![New_one](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/6_1.png)
![https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/6_1.png](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/6_2.png)

**Ответ: верхний правый, с 3-мя выбросами.**

## 7 вопрос

Сопоставь гистограммы с соответствующими распределениями, проставив необходимые цифры напротив картинок.

1. Нормальное распределение -- 2 изображение
2. Логнормальное распределение -- 5 изображение
3. Биномиальное распределение -- 3 изображение
4. Распределение Стьюдента -- 4 изображение
5. Экспоненциальное распределение -- 1 изображение

К сожалению, пропущен 3-ий ответ.

![](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/7_1.png)

![](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/7_2.png)

## 8 вопрос

Определи значение математического ожидания величины, гистограмма распределения которой изображена на графике:

![](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/8.png)

**Ответ: примерно 180.**

## 9 вопрос

В чём заключается смысл одной из формулировок центральной предельной теоремы?
* Распределение выборочных средних отражает распределение генеральной совокупности.
* **(+)Если взять достаточное количество выборок большого и одинакового размера, то их выборочные средние будут распределены вокруг истинного среднего генеральной совокупности близко к нормальному закону.**
* Уменьшение размера выборки приводит к снижению дисперсии распределения выборочных средних вокруг среднего генеральной совокупности.
* Увеличение размера выборки приводит к росту дисперсии распределения выборочных средних вокруг среднего генеральной совокупности.
* Затрудняюсь ответить

## 10 вопрос

На весёлой ферме каждое лето собирают урожай баклажанов. Чтобы оценить качество продукции, нужно проверить, не изменился ли средний вес плода с прошлого года. Один генно-модифицированный баклажан в прошлом году в среднем весил 5 килограмм.

Сформулируй нулевую и альтернативную гипотезы?

**H0: средний вес не изменился (остался в рамках доверительного интервала, построенного вокруг значения 5 килограмм).**
**H1: средний вес изменился.**

## 11 вопрос

Пять лет назад жители Готэм-Сити в среднем съедали 9 шоколадок в год. Нужно узнать, изменилось ли это значение с тех пор, как местный предприниматель начал продавать шоколадные батончики под брендом «Пингвин». Были проведены несколько опросов, каждый из которых позволил оценить среднее количество съеденных шоколадок в год.

Вот графическое изображение результатов:

![](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/11.png)

Что мы можем сказать, глядя на график?

Выбери все подходящие варианты
* Уровень критической значимости — 5%
* Нулевую гипотезу следует отвергнуть
* **(+) Значения на графике распределены нормально**
* Недостаточно данных, чтобы сделать какие-то выводы
* **(+) Нулевая гипотеза не может быть отвергнута**
* Нулевая гипотеза гласит, что среднее число съеденных шоколадок равно 9
* Затрудняюсь ответить

Комментарий:

Значения на графике распределены нормально или по Стьюденту. Среднее скорее всего около 9 и скорее всего отвергнуть 0-ую гипотезу нельзя, но это не точно, нужны рассчёты.

## 12 вопрос

Необходимо узнать, равно ли количество съеденных за год шоколадок девяти.

Какой тест следует выбрать для проверки гипотезы?
* **(+) Двусторонний тест для нулевой гипотезы о том, что значение выборки с независимыми наблюдениями будет равно заданному среднему совокупности**
* T-тест для средних двух независимых выборок
* Односторонний тест для нулевой гипотезы о том, что значение выборки с независимыми наблюдениями будет равно заданному среднему совокупности
* Затрудняюсь ответить

## 13 вопрос

Ты провёл(-а) тест, чтобы подтвердить, что значение выборочного среднего равно 9, и получил(-а) p-value = 0.04.

Какое утверждение верно?
* Нулевую гипотезу следует отвергнуть.
* Вероятность того, что среднее генеральной совокупности не равно 9, — примерно 4%.
* Вероятность того, что нулевая гипотеза верна, равна 0.04%.
* Примерно 4% значений в выборке равны 9.
* **(+) Если среднее генеральной совокупности действительно равно 9, то 4 из 100 случайных выборок будут иметь такое среднее значение.**
* Затрудняюсь ответить

## 14 вопрос

Теперь ты хочешь проверить, действительно ли выросло количество съеденных шоколадок. Критический уровень статистической значимости примем равным 5%.

Что необходимо сделать, чтобы определить, что есть достаточные основания отвергнуть нулевую гипотезу?
* Удостовериться в том, что выборочное среднее больше 9, затем разделить p-value на два и сравнить результат с критическим уровнем статистической значимости. Если результат деления меньше критического уровня, то нулевая гипотеза может быть отвергнута.
* **(+) Удостовериться в том, что выборочное среднее больше 9, и проверить, меньше ли p-value, чем критический уровень статистической значимости.**
* Разделить значение p-value на два и посмотреть, меньше ли результат деления, чем критический уровень статистической значимости.
* Удостовериться в том, что выборочное среднее больше 9, затем разделить p-value на два и сравнить результат с критическим уровнем статистической значимости. В этом случае нулевая гипотеза может быть отвергнута.
* Затрудняюсь ответить

## 15 вопрос

У тебя есть выборки с данными о продажах игр за один день с двух разных сайтов: df_1 и df_2. В каждой из них 1 000 значений, и ожидается, что распределения будут обладать одинаковыми свойствами. Критический уровень статистической значимости равен 10%.

Что необходимо сделать, чтобы определить, отвергнуть или не отвергнуть гипотезу о равенстве средних совокупностей?
* **(+) Использовать метод scipy.stats.ttest_ind(df_1, df_2) и сравнить полученное значение p-value с заданным критическим уровнем значимости.**
* Использовать метод scipy.stats.ttest_rel(df_1, df_2) и сравнить полученное значение p-value с заданным критическим уровнем значимости.
* Затрудняюсь ответить

Комментарий: неизвестно, насколько это разные сайты и насколько независимы продажи. Влияние оценок, обзоров и в целом сетевой эффект никто не отменял.

## 16 вопрос

Пусть из 201 случайно отобранных сотрудников разработки 85 ездят на работу на велосипеде в тёплое время года, а из 300 сотрудников отдела паблишинга таких оказалось 134.

Можно ли сказать, что одинаковая доля сотрудников каждого подразделения ездит на велосипеде на работу в тёплое время года? Как это проверить?

**Ответ: Можно сказать, что статистически значимые различия не обнаружены.**

**Решение**:

**Критерий Хи-квадрат**:

Значение критерия: 0.277	Уровень значимости: 0.599


**Критерий Хи-квадрат с поправкой Йейтса**:

Значение критерия: 0.188	Уровень значимости: 0.665


**Критерий Хи-квадрат с поправкой на правдоподобие**:

Значение критерия: 0.277	Уровень значимости: 0.599


**Точный критерий Фишера (двусторонний)**:

Уровень значимости: p > 0.05

# SQL Блок

## 17 вопрос

Перед тобой упрощённая ER-диаграмма выдуманной игры, в которой у игроков есть персонажи, игроки могут объединяться в кланы, кланы могут нападать друг на друга и быть захватчиками или захваченными. Также кланы могут ходить в рейды и получать награды за успешное прохождение приключения.

![](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/17.png)

Составь с помощью диаграммы запросы на любом диалекте SQL для ответов на следующие вопросы:

### 1 SQL
Проанализируй, какой игровой класс в каком году пользовался популярностью. Для каждого года из диапазона 2014-2024 выведи самый популярный класс (char_class) персонажа.

**Комментарий**:

В задании не указано, что подразумевается под "пользовался популярностью". Как часто персонажей класса создавали, как часто с ними происходили активности: их приглашали в клан, в рейд, процентное соотношение активных игроков за конкретный класс к общему количеству и прочее.
В рамках полученных данных можно посчитать только частоту создания персонажей конкретного класса по годам и вывести наиболее популярного.
Пояснения:
1. подзапрос t1: берём из CHAR_INFO только char_class, а created_at из timestamp преобразуем в Year;
2. подзапрос t2: с группировкой по классу и году высчитываем количество созданных персонажей;
3. подзапрос t3: используем оконную функцию ROW_NUMBER с группировкой по году и убывающей сортировкой;
4. итоговый запрос: WHERE rn = 1 -- фактически аналог Limit, только внутри группировки по году. Дополнительно сортируем результат по возрастанию created_at

``` sql
SELECT
char_class,
created_at
FROM
(   SELECT
    char_class,
    created_at,
    ROW_NUMBER() OVER (PARTITION BY year ORDER BY count_ DESC) AS rn
    FROM
    (   SELECT
        char_class,
        created_at,
        COUNT(*) AS count_,
        FROM
        (   SELECT
            char_class,
            YEAR(created_at) AS created_at
            FROM CHAR_INFO) AS t1
        WHERE created_at >= 2014 AND created_at <= 2024
        GROUP BY created_at, char_class) AS t2) AS t3
WHERE rn = 1
ORDER BY created_at ASC;
```

### 2 SQL

Посчитай количество игроков, чья страна регистрации (country_code из таблицы players) не соответствует стране регистрации клана (country_code таблицы clan_info), в котором он состоит.

В задании название таблицы написано в нижнем регистре, а в диаграмме классов (точнее в её аналоге ER-диаграмме) -- в верхнем. Небольшое замечание: в некоторых версиях SQL особенно в названиях таблиц компилятор чувствителен к регистру.

Алгоритм:
1. подзапрос t1: объединяем таблицы LEFT JOIN;
2. итоговый запрос: оставляем только строки с несовпадающими странами (игрок мог быть без клана, поэтому также используем clan_country IS NOT NULL).


``` sql
SELECT
COUNT(*) AS count_player
FROM
    (SELECT
    PLAYERS.country_code AS player_country,
    CLAN_INFO.country_code AS clan_country
    FROM PLAYERS
    LEFT JOIN CLAN_INFO
    ON PLAYERS.clan_id = CLAN_INFO.id) AS t1
WHERE clan_country IS NOT NULL AND clan_country != player_country;
```

### 3 SQL

Проанализируй, в какой стране(country_code) самые активные и успешные кланы. Для каждой страны выведи общее количество кланов, а также среднее количество успешных рейдов (successful_raids) и успешных захватов других кланов (successful_invasions). Отсортируй страны по уменьшению среднего количества успешных рейдов. Не учитывай страны, к флагу которой принадлежит меньше пяти кланов.

``` sql
SELECT
    country_code,
    COUNT(*) AS clans_number,
    AVG(successful_raids) AS successful_raids,
    AVG(successful_invasions) AS successful_invasions
FROM CLAN_INFO
GROUP BY country_code
HAVING COUNT(*) >= 5
ORDER BY AVG(successful_raids) DESC;
```
### 4 SQL
Выведи топ-10 кланов по количеству захваченных кланов в 2023 году.

Небольшая проблема в данных: у нас нет данных именно за 2023 год. Максимум, что возможно: ограничить кланы, закрытые раньше 2023 года и открытые не позднее 2023.
``` sql
SELECT clan_name
FROM
    (SELECT
    clan_name,
    successful_invasions,
    YEAR(founded_at) AS founded_at,
    YEAR(closed_at) AS founded_at
    FROM CLAN_INFO) AS t1
WHERE founded_at <= 2023 AND closed_at >= 2023
ORDER BY successful_invasions DESC
LIMIT 10;
```

### 5 SQL

Для каждого клана из топ-10 выведи его статус, но оставь только кланы, в которых состоят только опытные игроки. Опытный игрок — тот, чьи персонажи превышают 20 уровень (char_level > 20)

Проблема с заданием: "Опытный игрок — тот, чьи персонажи превышают 20 уровень (char_level > 20)," -- возможность двойной трактовки. Есть хотя бы 1 персонаж, превышающий 20 уровень или все персонажи строго выше 20-го уровня? Есть решение для обоих вариантов.

Алгоритм:
1. подзапрос t1 и t2 аналогичны предыдущему заданию;
2. подзапрос t3: сначала LEFT JOIN таблицу игроков по id клана, потом LEFT JOIN таблицу персонажей по id игрока, группируем по id клана из t2 и находим MIN значение уровня персонажа по всем персонажам по всем игрокам конкретного клана.
* *  Так решается ситуация, когда "Все персонажи строго выше 20-го уровня", для второй ситуации нужно по каждому персонажу сделать столбец "0 или 1" -- есть ли хоть 1 персонаж 20-го уровня и с группировкой по клану перемножить этот столбец.
3. Итоговый запрос: фильтруем min_lvl > 20

``` sql
SELECT
id,
clan_name,
status
FROM
    (SELECT
    t1.id AS id,
    t1.clan_name AS clan_name,
    t1.status AS status,
    MIN(CHAR_INFO.char_level) AS min_lvl
    FROM
        (SELECT
        id,
        clan_name,
        status
        FROM
            (SELECT
            id,
            clan_name,
            status,
            successful_invasions,
            YEAR(founded_at) AS founded_at,
            YEAR(closed_at) AS founded_at
            FROM CLAN_INFO) AS t1
        WHERE founded_at <= 2023 AND closed_at >= 2023
        ORDER BY successful_invasions DESC
        LIMIT 10) AS t2
    LEFT JOIN PLAYERS
    ON PLAYERS.clan_id = t2.id
    LEFT JOIN CHAR_INFO
    ON CHAR_INFO.player_id= PLAYERS.id
    GROUP BY t2.id) AS t3
WHERE min_lvl > 20
```

### 6 SQL

Для каждого клана (clan_name), основанного после 2017 года (founded_at), и у которого успешность участия в рейде превышает 75%, посчитай количество игроков (player_id), состоящих в нём.

Алгоритм:
1. подзапрос t1: создаём таблицу со всеми необходимыми данными, превращаем таймстемп в год: YEAR(founded_at);
2. подзапрос t2: фильтруем данные в соответствии с заданием;
3. итоговый запрос: объединяем таблицу с Players по clan_id, группируем по id клана и подсчитываем число игроков в ней.

``` sql
SELECT
t2.clan_name AS clan_name ,
COUNT(*) AS players_number
FROM
    (SELECT
    id,
    clan_name
    FROM
        (SELECT
        id,
        clan_name,
        successful_raids / raid_cnt AS successful_raids_prc,
        YEAR(founded_at) AS founded_at
        FROM CLAN_INFO) AS t1
    WHERE founded_at > 2017 AND successful_raids_prc > 0.75) AS t2
LEFT JOIN PLAYERS
ON PLAYERS.clan_id = t2.id
GROUP BY t2.id;
```

### 7 SQL

Проверь качество данных. Выведи названия кланов, у которых доля успешно завершённых рейдов, посчитанная через данные таблицы clan_info, не совпадает с долей успешно завершённых рейдов, посчитанной через таблицы started_raids и finished_raids.

``` sql
SELECT
clan.clan_name
FROM
    (SELECT
    id,
    clan_name,
    successful_raids / raid_cnt AS successful_raids_prc
    FROM CLAN_INFO) AS clan
LEFT JOIN
    (SELECT
    clan_id,
    COUNT(*) as cnt
    FROM STARTED_RAIDS
    GROUP BY clan_id) AS start
ON clan.id = start.clan_id
LEFT JOIN
    (SELECT
    clan_id,
    COUNT(*) as cnt
    FROM FINISHED_RAIDS
    GROUP BY clan_id) AS finish
ON clan.id = finish.clan_id
WHERE successful_raids_prc != finish.cnt / start.cnt
```

### 8 SQL

Выведи рейтинг топ-5 кланов (название клана и количество заработанного золота в рейдах) по количеству заработанного золота(gold) в период с 2018 года.

``` sql
SELECT
clan.clan_name AS clan_name,
finish.gold AS gold
FROM
    (SELECT
    id,
    clan_name,
    FROM CLAN_INFO) AS clan
LEFT JOIN
    (SELECT
    clan_id,
    SUM(gold) AS gold
    FROM
        (SELECT
        clan_id,
        gold,
        YEAR(finished_at) AS finished_at
        FROM FINISHED_RAIDS) AS t1
    WHERE finished_at >= 2018
    GROUP BY clan_id) AS finish
ON clan.id = finish.clan_id
ORDER BY finish.gold DESC
LIMIT 5;
```

# Блок с метриками

## 18 вопрос

Дневная аудитория новой MMORPG (DAU) в каждый из дней ноября была равна 100 пользователям.

Что мы можем сказать о MAU декабря? 
* MAU = 100
* MAU = 1100
* MAU = 3100
* 100 <= MAU <=3100
* **(+) Затрудняюсь ответить**

Комментарий: "Затрудняюсь ответить", потому что данных за декабрь у нас нет. Есть только данные за ноябрь.

## 19 вопрос

Наступил январь, и хочется оценить, как выпущенный в ноябре патч повлиял на монетизацию новых пользователей в игре.

Какой из методов подойдет лучше всего?
* **(+) Когортный анализ**
* Воронки
* A/B тест
* Ни один из вариантов
* Затрудняюсь ответить

## 20 вопрос

В каком случае мы можем посчитать (хотя бы приблизительно) LTV (сколько денег в среднем приносит игрок за весь свой жизненный цикл в проекте) игрока в нашем MMO?
* Если мы знаем количество новых пользователей и CPI (cost per install – средняя стоимость привлечения пользователя, аналог CPA в геймдеве).
* **(+) Если мы знаем количество новых пользователей, размер аудитории и показатели удержания.**
* Если мы знаем среднедневной ARPU и показатели удержания.
* Если мы знаем долю платящих, ARPU и ARPPU.
* Затрудняюсь ответить

## 21 вопрос

Выбери визуализацию, которая, на твой взгляд, более удачно отображает ответы на вопросы.

Чтобы выбрать, просто кликни по картинке

![](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/21_1.png)

![](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/21_2.png)

**Ответ:**
1. я -- дальтоник и на первом я практически не различаю варианты ответа (неудачный подбор цветов);
2. в противном случае я бы предпочёл первый вариант так как в данном случае 1 чуть более сложная когнитивная операция лучше 5 более простых. Сразу очевидны пропорции.


## 22 вопрос

Выбери визуализацию, которая, на твой взгляд, более удачна для наблюдения за динамикой.

Чтобы выбрать, просто кликни по картинке

![](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/22_1.png)

![](https://github.com/Roman3173/RomanGo/blob/main/Test%20cases/Lesta%20games/images/22_2.png)

Первая, так как нагляднее демонстрирует расхождение трендов.

В мая количество открытых задач стало превышать количество выполненных, причём разница трендов оказалась стабильна до конца года. Возможные причины:
1. выход в релиз продукта компании -- задачи с продакшна / техподдержки;
2. изменение ситуации на рынке (новый конкурент или значительное улучшение предложения действующего конкурента) и потребность стремительно подстроиться под новые реалии;
3. изменение условий бизнеса (новый закон, экономический кризис и прочее), вероятность ниже, так как обычно в этом случае разница трендов не такая стабильная: либо расхождение стремительно растёт, либо разница быстро выходит на докризисный уровень.
